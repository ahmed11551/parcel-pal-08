# üí≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CloudPayments –¥–ª—è —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã—Ö

## üéØ –ü–æ—á–µ–º—É CloudPayments?

**–õ—É—á—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã—Ö –≤ –†–æ—Å—Å–∏–∏:**
- ‚úÖ –ù–∏–∑–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è: –æ—Ç 2.5%
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: 1-2 –¥–Ω—è
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö—Å—Ç–∞–¥–∏–π–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π (—ç—Å–∫—Ä–æ—É)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ "–ú–æ–π –Ω–∞–ª–æ–≥"
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ: 1-3 –¥–Ω—è
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üìù –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://cloudpayments.ru/
2. –ù–∞–∂–º–∏—Ç–µ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
3. –í—ã–±–µ—Ä–∏—Ç–µ "–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∫–µ—Ç—É:
   - –§–ò–û
   - –ò–ù–ù (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   - Email
   - –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤

---

## üîë –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π

–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
- **PublicId** ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- **ApiSecret** ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è API

**–í–∞–∂–Ω–æ:** ApiSecret –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑! –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ.

---

## ‚öôÔ∏è –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ

### 3.1. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```env
# CloudPayments (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã—Ö)
CLOUDPAYMENTS_PUBLIC_ID=your_public_id_here
CLOUDPAYMENTS_API_SECRET=your_api_secret_here

# –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ÆKassa –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret_key
```

### 3.2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend:

```bash
cd ~/parcel-pal-08/backend
docker restart sendbuddy-backend
```

---

## üîó –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook

1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç CloudPayments
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "Webhooks"
3. –î–æ–±–∞–≤—å—Ç–µ URL:
   ```
   http://–≤–∞—à_—Å–µ—Ä–≤–µ—Ä:3001/api/payments/webhook/cloudpayments
   ```
   –ò–ª–∏ –¥–ª—è HTTPS:
   ```
   https://–≤–∞—à_–¥–æ–º–µ–Ω/api/payments/webhook/cloudpayments
   ```

4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - ‚úÖ Payment succeeded (–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂)
   - ‚úÖ Payment failed (–ù–µ—É–¥–∞—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂)
   - ‚úÖ Payment cancelled (–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–π –ø–ª–∞—Ç–µ–∂)

---

## üß™ –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã CloudPayments:

**–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂:**
- –ù–æ–º–µ—Ä: `4111 1111 1111 1111`
- –°—Ä–æ–∫: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞
- CVV: –ª—é–±–æ–π 3 —Ü–∏—Ñ—Ä—ã
- –ò–º—è: –ª—é–±–æ–µ

**–ù–µ—É–¥–∞—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂:**
- –ù–æ–º–µ—Ä: `4000 0000 0000 0002`

---

## üí∞ –ö–æ–º–∏—Å—Å–∏–∏

- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è:** 2.5-3% (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±–æ—Ä–æ—Ç–∞)
- **–î–ª—è —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã—Ö:** –≤–æ–∑–º–æ–∂–Ω—ã –ª—å–≥–æ—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
- **–ó–∞—á–∏—Å–ª–µ–Ω–∏–µ:** 1-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **API:** https://developers.cloudpayments.ru/
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** https://developers.cloudpayments.ru/#integration
- **Webhooks:** https://developers.cloudpayments.ru/#webhooks

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:**
   ```bash
   curl -X POST http://localhost:3001/api/payments \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "orderId": "order_id",
       "provider": "cloudpayments"
     }'
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
   ```bash
   docker logs -f sendbuddy-backend | grep CloudPayments
   ```

3. **–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ CloudPayments:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ö–æ–¥—è—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook —Å–æ–±—ã—Ç–∏—è

---

## üéâ –ì–æ—Ç–æ–≤–æ!

CloudPayments –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:**
- ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã—Ö
- ‚úÖ –ù–∏–∑–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## üîÑ –†–µ–∑–µ—Ä–≤–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å –ÆKassa –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å CloudPayments.

–í –∫–æ–¥–µ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞:
- `provider: "cloudpayments"` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `provider: "yookassa"` ‚Äî —Ä–µ–∑–µ—Ä–≤–Ω—ã–π

