# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ PostgreSQL

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∞: `role "sendbuddy" does not exist`

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ-–¥—Ä—É–≥–æ–º—É.

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î

```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose exec postgres env | grep POSTGRES
```

### 2. –í–µ—Ä–æ—è—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `postgres`):

```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
docker compose exec postgres psql -U postgres -d sendbuddy -c "
INSERT INTO telegram_notifications (telegram_id, type, title, message)
VALUES (
  8401704531,
  'new_task',
  'üß™ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ',
  '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ! –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –µ–≥–æ, –∑–Ω–∞—á–∏—Ç —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç.'
);
"
```

### 3. –ò–ª–∏ —á–µ—Ä–µ–∑ DATABASE_URL:

–ï—Å–ª–∏ –≤ docker-compose.yml —É–∫–∞–∑–∞–Ω DATABASE_URL, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ —Ñ–æ—Ä–º–∞—Ç.

---

## üîç –ö–∞–∫ —É–∑–Ω–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ docker-compose.yml

```bash
grep -A 10 "postgres:" docker-compose.yml
```

–ò—â–∏—Ç–µ `POSTGRES_USER` –∏–ª–∏ `DATABASE_URL`.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker compose exec postgres printenv | grep POSTGRES
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏

```bash
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ postgres
docker compose exec postgres psql -U postgres -l

# –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
docker compose exec postgres psql -U sendbuddy -l 2>&1 || echo "–ù–µ postgres"
```

---

## üìù –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ USERNAME –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ 'postgres')
docker compose exec postgres psql -U USERNAME -d sendbuddy -c "
INSERT INTO telegram_notifications (telegram_id, type, title, message)
VALUES (
  8401704531,
  'new_task',
  'üß™ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ',
  '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ! –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –µ–≥–æ, –∑–Ω–∞—á–∏—Ç —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç.'
);
"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–ª–æ—Å—å
docker compose exec postgres psql -U USERNAME -d sendbuddy -c "
SELECT id, type, title, sent, created_at 
FROM telegram_notifications 
WHERE telegram_id = 8401704531 
ORDER BY created_at DESC 
LIMIT 5;
"
```

---

## ‚úÖ –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥ - –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –≤—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã).

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞:
```bash
docker compose logs telegram-bot --tail=30 | grep -i notification
```

---

## üéØ –ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ USERNAME –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è
docker compose exec postgres psql -U USERNAME -d sendbuddy -c "
SELECT 
  tu.telegram_id,
  tu.first_name,
  tu.subscribed,
  ts.active as subscription_active
FROM telegram_users tu
LEFT JOIN telegram_subscriptions ts ON tu.telegram_id = ts.telegram_id
WHERE tu.telegram_id = 8401704531;
"
```

---

## üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –±–æ—Ç–∞

–í–º–µ—Å—Ç–æ SQL –∫–æ–º–∞–Ω–¥, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –±–æ—Ç–∞:

```
/test_notification
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞—Å—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤–∞—à—É –ø–æ–¥–ø–∏—Å–∫—É!

