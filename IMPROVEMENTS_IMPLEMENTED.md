# –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

## ‚úÖ 1. –ò–Ω–¥–µ–∫—Å—ã –≤ –ë–î –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:
- **Users**: `phone`, `created_at`
- **Tasks**: `sender_id`, `courier_id`, `status`, `(from_airport, to_airport)`, `(status, created_at DESC)`, `(date_from, date_to)`, `created_at DESC`
- **Messages**: `task_id`, `(sender_id, receiver_id)`, `(read, created_at DESC)`
- **Payments**: `task_id`, `sender_id`, `courier_id`, `status`
- **SMS codes**: `phone`, `(phone, code)`, `expires_at`, `(used, created_at)`
- **Telegram**: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **Ratings**: `task_id`, `to_user_id`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 5-10 —Ä–∞–∑
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JOIN –æ–ø–µ—Ä–∞—Ü–∏–π
- –ë—ã—Å—Ç—Ä–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –∏ –¥–∞—Ç–∞–º

## ‚úÖ 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Pino)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- **Development**: –ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ü–≤–µ—Ç–∞–º–∏ (`pino-pretty`)
- **Production**: JSON —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –ª–æ–≥–æ–≤
- **–£—Ä–æ–≤–Ω–∏**: `debug`, `info`, `warn`, `error`
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (userId, requestId, etc.)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```typescript
import { logger } from './utils/logger.js';

logger.info({ userId: 123, action: 'task_created' }, 'Task created');
logger.error({ err: error, taskId: 456 }, 'Failed to create task');
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:
```env
LOG_LEVEL=info  # debug, info, warn, error
```

## ‚úÖ 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Endpoint –º–µ—Ç—Ä–∏–∫:
```
GET /api/metrics
```

### –°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **HTTP –∑–∞–ø—Ä–æ—Å—ã**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è, min/max
- **SMS –æ—Ç–ø—Ä–∞–≤–∫–∞**: –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å (success/error)
- **Telegram API**: –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "timestamp": "2025-12-21T00:00:00.000Z",
  "metrics": {
    "httpRequests": {
      "count": 150,
      "avg": 45.2,
      "min": 12,
      "max": 234
    },
    "sms": {
      "count": 30,
      "avg": 1200,
      "min": 800,
      "max": 3500
    }
  },
  "allMetrics": [...]
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```typescript
import { metrics } from './utils/logger.js';

metrics.record('operation_duration', 150, { type: 'database' });
const stats = metrics.getMetricStats('operation_duration');
```

## ‚úÖ 4. –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã:
- **SMS API**: 10 —Å–µ–∫—É–Ω–¥
- **Telegram API**: 5 —Å–µ–∫—É–Ω–¥ (–≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é)

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```typescript
async function fetchWithTimeout(url: string, options: RequestInit, timeout: number) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);
  
  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal,
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    clearTimeout(timeoutId);
    if (error.name === 'AbortError') {
      throw new Error(`Request timeout after ${timeout}ms`);
    }
    throw error;
  }
}
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- ‚ö° –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î —É—Å–∫–æ—Ä–µ–Ω—ã –≤ 5-10 —Ä–∞–∑
- üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π –≤–Ω–µ—à–Ω–∏—Ö API

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- üìä Endpoint `/api/metrics` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- üîç –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã –≤ production

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:
- ‚è±Ô∏è –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è
- üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É–∑–∫–∏–µ –º–µ—Å—Ç–∞
- üîç –õ–æ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞:

```bash
cd ~/parcel-pal-08
git pull
docker compose restart backend
docker compose logs -f backend
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫:
```bash
curl http://localhost:3001/api/metrics
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
docker compose logs backend | tail -100
```

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```env
LOG_LEVEL=info  # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ production:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–±–æ—Ä –ª–æ–≥–æ–≤ (ELK, Loki, CloudWatch)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

