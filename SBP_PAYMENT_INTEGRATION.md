# Интеграция СБП (Система Быстрых Платежей)

## Варианты реализации

### Вариант 1: СБП через банковский API (рекомендуется для MVP)

**Тинькофф API:**
- СБП переводы по номеру телефона
- API документация: https://www.tinkoff.ru/kassa/develop/api/
- Требует регистрации в Тинькофф Касса

**Сбер API:**
- СБП переводы
- Более сложная интеграция
- Требует подключения к СберБизнес API

**Альтернатива - Тинькофф Business API:**
- Платежи по номеру телефона через СБП
- Проще чем полная интеграция кассы
- Требует бизнес-аккаунт

### Вариант 2: Простой вариант для MVP (быстрый старт)

**Ручной перевод с отслеживанием:**
1. Показывать реквизиты получателя (номер телефона, счет)
2. Отправитель переводит вручную через банк/СБП
3. Подтверждение перевода в системе
4. Статус задания обновляется

**Преимущества:**
- Нет интеграции с банками
- Быстрый запуск
- Работает сразу

**Недостатки:**
- Нет автоматизации
- Требует доверия между пользователями

### Вариант 3: Гибридный подход (рекомендуется)

1. **При создании задания:**
   - Отправитель выбирает способ оплаты: СБП или ручной перевод
   - Если СБП - показываем форму для перевода
   - Если ручной - показываем реквизиты курьера

2. **При принятии задания:**
   - Курьер указывает свои реквизиты (номер телефона/счет)
   - Система сохраняет их

3. **Перевод средств:**
   - Отправитель видит реквизиты курьера
   - Может перевести через СБП (вручную или через API)
   - Подтверждает перевод в системе

4. **После доставки:**
   - Автоматическое высвобождение не требуется
   - Курьер получает деньги напрямую отправителем

## Рекомендация для MVP

**Начать с Варианта 2 (Простой), затем добавить API:**

1. **Этап 1 (сейчас):**
   - Добавить поле для реквизитов курьера (телефон/счет)
   - Показывать реквизиты отправителю
   - Ручное подтверждение перевода

2. **Этап 2 (позже):**
   - Интегрировать Тинькофф Business API для СБП
   - Автоматизировать переводы

## Что нужно добавить в БД

```sql
-- Добавить в таблицу users
ALTER TABLE users ADD COLUMN IF NOT EXISTS phone_sbp VARCHAR(20);
ALTER TABLE users ADD COLUMN IF NOT EXISTS account_number VARCHAR(50);

-- Или отдельная таблица для реквизитов
CREATE TABLE IF NOT EXISTS user_payment_details (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  phone_sbp VARCHAR(20),
  account_number VARCHAR(50),
  bank_name VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## Что нужно добавить в API

1. **Обновить профиль пользователя:**
   - POST `/api/users/profile` - добавить реквизиты

2. **Получить реквизиты курьера:**
   - GET `/api/tasks/:id/payment-details` - реквизиты для перевода

3. **Подтвердить перевод:**
   - POST `/api/tasks/:id/confirm-payment` - отправитель подтверждает перевод

## Frontend изменения

1. **Профиль:**
   - Форма для добавления СБП реквизитов

2. **Создание задания:**
   - Выбор способа оплаты

3. **Страница задания:**
   - Показать реквизиты курьера
   - Кнопка "Подтвердить перевод"

4. **Мои задания:**
   - Статус оплаты

