# ✅ Система отмены заданий - Реализовано

## Что реализовано:

### Backend ✅
1. **Endpoint для отмены:**
   - `POST /api/tasks/:id/cancel` - отменить задание или отказ от задания

2. **Логика отмены:**
   - **Отправитель** может отменить задание только если статус `active` (курьер еще не назначен)
   - **Курьер** может отказаться от задания если статус `assigned` (при этом задание возвращается в статус `active`)
   - Отмена отправителем полностью закрывает задание (статус `cancelled`)
   - Отказ курьера просто снимает его с задания (задание снова активно для других курьеров)

3. **Безопасность:**
   - Проверка что пользователь является отправителем или курьером
   - Валидация статуса задания перед отменой
   - Логирование действий отмены

### Frontend ✅
1. **TaskDetail.tsx:**
   - Кнопка "Отменить задание" для отправителя (когда статус `active`)
   - Кнопка "Отказаться от задания" для курьера (когда статус `assigned`)
   - Подтверждение перед отменой
   - После отмены отправлением - перенаправление на страницу заданий

2. **Orders.tsx:**
   - Кнопка "Отменить задание" для активных заданий отправителя
   - Подтверждение перед отменой

3. **API метод:**
   - `api.cancelTask(taskId)` - отменить задание

## Как работает:

### Отмена отправителем:
1. Отправитель видит кнопку "Отменить задание" на активном задании
2. При нажатии появляется подтверждение
3. После подтверждения задание получает статус `cancelled`
4. Задание больше не отображается в списке активных

### Отказ курьера:
1. Курьер видит кнопку "Отказаться от задания" когда статус `assigned`
2. При нажатии появляется подтверждение
3. После подтверждения курьер снимается с задания
4. Задание возвращается в статус `active`
5. Другие курьеры могут взять это задание

## База данных:

При отмене отправителем:
- `status` → `cancelled`

При отказе курьера:
- `courier_id` → `NULL`
- `status` → `active`

## Статус: ✅ Готово и работает!

