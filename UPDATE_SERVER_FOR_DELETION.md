# Обновление сервера - добавление удаления заданий

## Команды для обновления на сервере:

```bash
# 1. Перейдите в директорию проекта
cd /root/parcel-pal-08

# 2. Получите последние изменения
git pull origin main

# 3. Добавьте новое поле deleted_at в таблицу tasks
docker compose exec postgres psql -U sendbuddy -d sendbuddy -c "ALTER TABLE tasks ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMP;"

# 4. Остановите контейнеры
docker compose down

# 5. Пересоберите backend
docker compose build --no-cache backend

# 6. Запустите контейнеры
docker compose up -d

# 7. Проверьте логи
docker compose logs backend --tail=30

# 8. Проверьте health check
curl http://localhost:3001/api/health
```

---

## Что изменилось:

✅ **Добавлено поле `deleted_at` в таблицу `tasks`**
- Тип: TIMESTAMP
- NULL = задание не удалено
- Значение = задание удалено (мягкое удаление)

✅ **Автоматическое удаление при доставке:**
- Когда статус задания меняется на `delivered`
- Автоматически устанавливается `deleted_at = CURRENT_TIMESTAMP`
- Задание скрывается из списков

✅ **Исключение из списков:**
- `GET /api/tasks` - публичный список (удаленные не показываются)
- `GET /api/tasks/my` - мои задания (удаленные не показываются по умолчанию)

✅ **Доступ к удаленным заданиям:**
- `GET /api/tasks/:id` - можно посмотреть если вы отправитель или курьер
- `GET /api/tasks/my?includeDeleted=true` - можно включить удаленные в список

---

## Проверка работы:

```bash
# 1. Создайте тестовое задание
# 2. Назначьте курьера
# 3. Отметьте как доставленное
# 4. Проверьте что задание исчезло из списка /api/tasks
# 5. Проверьте что задание все еще доступно по прямому ID (для владельца/курьера)
```

---

## Примечания:

- Задания **не удаляются физически** из БД - только помечаются как удаленные
- Это безопасно - данные сохраняются для истории
- Можно восстановить если нужно
- Можно посмотреть историю через `?includeDeleted=true`

